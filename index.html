<!DOCTYPE html>
<html lang="so">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0ea5e9">
    <title>Baxnaano Hospital & Pharmacy</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #0ea5e9; --secondary: #8b5cf6; --accent: #f97316;
            --dark: #1e293b; --light: #f8fafc; --success: #10b981; --danger: #ef4444;
            --glass: rgba(255, 255, 255, 0.1); --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; line-height: 1.6; color: var(--dark); background: linear-gradient(135deg, var(--light), #e0f2fe); overflow-x: hidden; }
        img, video { max-width: 100%; height: auto; display: block; }
        
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes float { 0% { transform: translate(0, 0) rotate(0deg); } 100% { transform: translate(-100px, -100px) rotate(360deg); } }
        @keyframes glow { 0%, 100% { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); } 50% { box-shadow: 0 30px 50px -5px rgba(14, 165, 233, 0.4); } }
        @keyframes puls { 0% { transform: scale(1); filter: brightness(1); } 100% { transform: scale(0.97); filter: brightness(1.2); } }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        nav { background: var(--glass); backdrop-filter: blur(10px); position: fixed; width: 100%; top: 0; z-index: 1000; box-shadow: var(--shadow); border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.8rem; font-weight: bold; color: var(--primary); display: flex; align-items: center; gap: 0.5rem; text-shadow: 0 0 10px rgba(14, 165, 233, 0.5); }
        .logo-img { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; }
        .nav-links { display: flex; list-style: none; gap: 2rem; }
        .nav-links a { color: var(--dark); text-decoration: none; font-weight: 600; transition: all 0.3s; padding: 0.5rem 1rem; border-radius: 25px; }
        .nav-links a:hover, .nav-links a:focus { background: var(--primary); color: white; transform: translateY(-2px); outline: none; }
        .mobile-menu-toggle { display: none; color: var(--dark); font-size: 1.5rem; cursor: pointer; background: var(--glass); border: none; padding: 0.5rem; border-radius: 8px; }

        .hero { margin-top: 60px; min-height: 100vh; background: linear-gradient(135deg, var(--dark), var(--primary)); display: flex; align-items: center; justify-content: center; color: white; text-align: center; padding: 2rem; position: relative; overflow: hidden; }
        .hero::before { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><circle cx="200" cy="200" r="50" fill="%230ea5e9" opacity="0.1"/><circle cx="800" cy="300" r="80" fill="%238b5cf6" opacity="0.1"/><circle cx="400" cy="700" r="60" fill="%23f97316" opacity="0.1"/></svg>'); animation: float 20s infinite linear; }
        .hero-content { position: relative; z-index: 1; max-width: 800px; background: var(--glass); backdrop-filter: blur(20px); padding: 3rem; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.2); animation: glow 3s infinite ease-in-out; }
        .hero h1 { font-size: 4rem; margin-bottom: 1rem; animation: fadeInUp 1s ease; text-shadow: 0 0 20px rgba(0, 0, 0, 0.5); }
        .hero h2 { font-size: 2rem; margin-bottom: 1rem; animation: fadeInUp 1s ease 0.2s both; opacity: 0.9; }
        .hero p { font-size: 1.3rem; margin-bottom: 2rem; animation: fadeInUp 1s ease 0.4s both; opacity: 0.8; }
        .btn { padding: 1rem 2.5rem; background: linear-gradient(135deg, var(--accent), #ff6b00); color: white; text-decoration: none; border-radius: 50px; font-weight: bold; transition: all 0.3s; animation: fadeInUp 1s ease 0.6s both; border: none; cursor: pointer; font-size: 1rem; box-shadow: 0 10px 20px rgba(249, 115, 22, 0.3); display: inline-block; text-align: center; }
        .btn:hover, .btn:focus { transform: translateY(-5px) scale(1.05); box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4); background: linear-gradient(135deg, var(--primary), #0284c7); outline: 3px solid rgba(14, 165, 233, 0.5); }
        .btn-block { width: 100%; padding: 1rem; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none !important; }

        section { padding: 5rem 2rem; max-width: 1200px; margin: 0 auto; }
        .section-title { text-align: center; font-size: 3rem; margin-bottom: 3rem; color: var(--dark); position: relative; }
        .section-title::after { content: ''; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); width: 100px; height: 4px; background: var(--primary); border-radius: 2px; }

        .services-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
        .service-card { background: var(--glass); backdrop-filter: blur(10px); padding: 2rem; border-radius: 20px; box-shadow: var(--shadow); transition: all 0.4s; text-align: center; border: 1px solid rgba(255, 255, 255, 0.2); }
        .service-card:hover, .service-card:focus-within { transform: translateY(-15px) rotateX(5deg); box-shadow: 0 30px 60px rgba(0,0,0,0.2); background: rgba(255, 255, 255, 0.2); }
        .service-icon { font-size: 4rem; margin-bottom: 1rem; animation: puls 3s infinite alternate; }

        .pharmacy-section { background: linear-gradient(135deg, #f0f9ff, #f5f3ff); }
        .medicine-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; margin-bottom: 3rem; }
        .medicine-card { background: white; border-radius: 20px; overflow: hidden; box-shadow: var(--shadow); transition: all 0.4s; border: 1px solid rgba(0, 0, 0, 0.05); }
        .medicine-card:hover, .medicine-card:focus-within { transform: translateY(-15px) rotateX(5deg) scale(1.02); box-shadow: 0 30px 60px rgba(0, 0, 0, 0.2); }
        .medicine-image { height: 200px; background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem; position: relative; overflow: hidden; }
        .medicine-image img { width: 100%; height: 100%; object-fit: cover; }
        .medicine-content { padding: 1.5rem; }
        .medicine-name { font-size: 1.3rem; font-weight: bold; color: var(--dark); margin-bottom: 0.5rem; }
        .medicine-price { font-size: 1.5rem; color: var(--primary); font-weight: bold; margin-bottom: 1rem; }
        .quantity-selector { display: flex; align-items: center; gap: 0.5rem; margin: 1rem 0; }
        .quantity-btn { width: 30px; height: 30px; border: 1px solid var(--primary); background: white; color: var(--primary); border-radius: 50%; font-weight: bold; cursor: pointer; transition: all 0.2s; }
        .quantity-btn:hover { background: var(--primary); color: white; }
        .quantity-input { width: 50px; text-align: center; border: 1px solid #e2e8f0; border-radius: 4px; padding: 0.25rem; }
        .add-to-cart-btn { width: 100%; padding: 0.8rem; background: var(--success); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        .add-to-cart-btn:hover, .add-to-cart-btn:focus { background: #059669; transform: translateY(-3px); }

        .cart-container { max-width: 800px; margin: 3rem auto 0; background: var(--glass); backdrop-filter: blur(10px); padding: 2rem; border-radius: 20px; box-shadow: var(--shadow); border: 1px solid rgba(255, 255, 255, 0.2); }
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid rgba(0, 0, 0, 0.1); transition: background 0.3s; }
        .cart-item:hover { background: rgba(255, 255, 255, 0.2); border-radius: 10px; }
        .cart-total { text-align: right; margin-top: 1.5rem; font-size: 1.8rem; font-weight: bold; color: var(--dark); padding: 1rem; background: var(--glass); border-radius: 10px; }

        .delivery-form { max-width: 600px; margin: 3rem auto; background: white; padding: 2.5rem; border-radius: 20px; box-shadow: var(--shadow); border: 1px solid rgba(0, 0, 0, 0.05); }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: bold; color: var(--dark); }
        .form-group input, .form-group textarea { width: 100%; padding: 1rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem; }
        .form-group input:focus, .form-group textarea:focus { outline: none; border-color: var(--primary); }
        .form-group textarea { resize: vertical; min-height: 100px; }

        .gallery-section { background: linear-gradient(135deg, #f0f9ff, #f5f3ff); }
        .gallery-controls { text-align: center; margin-bottom: 2rem; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; }
        .filter-btn { padding: 0.5rem 1.5rem; border: 2px solid #e2e8f0; border-radius: 25px; background: white; cursor: pointer; transition: all 0.3s; font-weight: bold; }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem; }
        .gallery-item { background: white; border-radius: 20px; overflow: hidden; box-shadow: var(--shadow); transition: all 0.4s; cursor: pointer; border: 1px solid rgba(0, 0, 0, 0.05); }
        .gallery-item:hover, .gallery-item:focus-within { transform: translateY(-15px) rotateX(5deg); box-shadow: 0 30px 60px rgba(0,0,0,0.2); }
        .gallery-media { width: 100%; height: 250px; object-fit: cover; }
        .gallery-overlay { padding: 1.5rem; }
        .loading { text-align: center; padding: 3rem; color: #64748b; }
        .error { text-align: center; padding: 3rem; color: var(--danger); }
        .notification { position: fixed; top: 20px; right: 20px; padding: 1rem 2rem; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 9999; animation: slideIn 0.5s ease; }
        .notification.success { background: var(--success); color: white; }
        .notification.error { background: var(--danger); color: white; }
        .notification.warning { background: var(--warning); color: white; }

        footer { background: var(--glass); backdrop-filter: blur(10px); color: white; text-align: center; padding: 3rem 2rem; border-top: 1px solid rgba(255, 255, 255, 0.1); }
        .social-links { margin: 1.5rem 0; }
        .social-links a { color: white; font-size: 2rem; margin: 0 1rem; transition: all 0.3s; display: inline-block; text-decoration: none; }
        .social-links a:hover, .social-links a:focus { color: var(--primary); transform: translateY(-5px) rotateY(180deg); }

        @media (max-width: 768px) {
            .nav-links { display: none; position: absolute; top: 100%; left: 0; right: 0; background: var(--glass); backdrop-filter: blur(10px); flex-direction: column; padding: 1rem; }
            .nav-links.active { display: flex; }
            .mobile-menu-toggle { display: block; }
            .hero h1 { font-size: 2.5rem; }
            .hero h2 { font-size: 1.5rem; }
            .section-title { font-size: 2rem; }
            .gallery-controls { flex-direction: column; align-items: center; }
        }
    </style>
</head>
<body>
    <!-- NAVIGATION -->
    <nav role="navigation" aria-label="Main navigation">
        <div class="nav-container">
            <div class="logo">
                <div class="logo-img" id="logoDisplay" aria-hidden="true">üè•</div>
                Baxnaano Hospital
            </div>
            <ul class="nav-links" id="navLinks">
                <li><a href="#home">Home</a></li>
                <li><a href="#services">Services</a></li>
                <li><a href="#pharmacy">Pharmacy</a></li>
                <li><a href="#gallery">Gallery</a></li>
                <li><a href="#delivery">Delivery</a></li>
            </ul>
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu" aria-expanded="false">‚ò∞</button>
        </div>
    </nav>

    <!-- HERO -->
    <section id="home" class="hero" aria-labelledby="hero-title">
        <div class="hero-content">
            <h1 id="hero-title">Baxnaano Hospital</h1>
            <h2>Healthcare + Pharmacy</h2>
            <p>Complete healthcare services with online pharmacy & 2-hour delivery</p>
            <a href="#services" class="btn">Explore Services</a>
        </div>
    </section>

    <!-- SERVICES -->
    <section id="services" aria-labelledby="services-title">
        <h2 class="section-title" id="services-title">Our Services</h2>
        <div class="services-grid">
            <div class="service-card">
                <div class="service-icon" aria-hidden="true">üè•</div>
                <h3>Hospital Care</h3>
                <p>24/7 emergency, specialist consultations, surgery & diagnostics</p>
            </div>
            <div class="service-card">
                <div class="service-icon" aria-hidden="true">üíä</div>
                <h3>Pharmacy</h3>
                <p>Online medicine ordering with 2-hour delivery</p>
            </div>
            <div class="service-card">
                <div class="service-icon" aria-hidden="true">üöö</div>
                <h3>Fast Delivery</h3>
                <p>Medicines delivered to your doorstep</p>
            </div>
        </div>
    </section>

    <!-- PHARMACY -->
    <section id="pharmacy" class="pharmacy-section" aria-labelledby="pharmacy-title">
        <h2 class="section-title" id="pharmacy-title">Pharmacy - Order Medicines</h2>
        <div class="medicine-grid" id="medicineGrid"><p class="loading">Loading medicines...</p></div>
        
        <div class="cart-container">
            <h3 style="margin-bottom: 1rem;">Shopping Cart</h3>
            <div id="cartItems"><p style="text-align: center; color: #64748b;">Your cart is empty</p></div>
            <div class="cart-total" id="cartTotal" style="display: none;">Total: <span id="totalPrice">$0</span></div>
        </div>
    </section>

    <!-- DELIVERY FORM -->
    <section id="delivery" aria-labelledby="delivery-title">
        <h2 class="section-title" id="delivery-title">Medicine Delivery Request</h2>
        <div class="delivery-form">
            <form id="deliveryForm">
                <div class="form-group"><label for="customerName">Full Name *</label><input type="text" id="customerName" required placeholder="Your full name" aria-required="true"></div>
                <div class="form-group"><label for="customerPhone">Phone Number *</label><input type="tel" id="customerPhone" required placeholder="061 349 0055" pattern="^(00252|\+252|0)(61|62|65|66|67|68|69|71|72|73|74|77|78|79|90|91|92|93|94|95|96|97|98)\d{6}$" title="Valid Somali phone: 061 349 0055 or +252613490055" aria-required="true"></div>
                <div class="form-group"><label for="deliveryAddress">Delivery Address *</label><textarea id="deliveryAddress" required placeholder="Full address for delivery..." aria-required="true"></textarea></div>
                <div class="form-group"><label for="prescriptionFile">Prescription (Optional)</label><input type="file" id="prescriptionFile" accept="image/*" aria-describedby="prescription-help"><small id="prescription-help">Upload prescription image if required (Max 5MB)</small></div>
                <div class="form-group"><label for="instructions">Special Instructions</label><textarea id="instructions" placeholder="e.g., Call on arrival..."></textarea></div>
                <button type="submit" class="btn btn-block" id="submitOrderBtn">üöö Request Delivery</button>
            </form>
            <div style="text-align: center; margin-top: 1rem;">
                <a href="#" id="ussdPaymentLink" class="btn" style="background: var(--success); display: none;">üí≥ Click to Pay: *712*684006666*<span id="ussdAmount">0</span>#</a>
                <p style="font-size: 0.9rem; color: #64748b; margin-top: 0.5rem;" id="ussdInstructions">Submit order first, then click to complete payment</p>
            </div>
        </div>
    </section>

    <!-- GALLERY -->
    <section id="gallery" class="gallery-section" aria-labelledby="gallery-title">
        <h2 class="section-title" id="gallery-title">Hospital Gallery</h2>
        <div class="gallery-controls">
            <button class="filter-btn active" data-filter="all" aria-pressed="true">All</button>
            <button class="filter-btn" data-filter="image" aria-pressed="false">Images</button>
            <button class="filter-btn" data-filter="video" aria-pressed="false">Videos</button>
        </div>
        <div class="gallery-grid" id="galleryGrid"><p class="loading">Loading gallery...</p></div>
    </section>

    <!-- FOOTER -->
    <footer role="contentinfo">
        <div class="logo" style="color: white; font-size: 2rem; margin-bottom: 1rem;">
            <div class="logo-img" id="footerLogoDisplay" style="display: inline-block; margin-right: 0.5rem;" aria-hidden="true">üè•</div>
            Baxnaano Hospital & Pharmacy
        </div>
        <p style="opacity: 0.8; margin-bottom: 1rem;">Healthcare Excellence in Somalia</p>
        <div class="social-links">
            <a href="https://wa.me/252613490055" title="WhatsApp" aria-label="WhatsApp">üí¨</a>
            <a href="tel:+252613490055" title="Hospital" aria-label="Hospital Phone">üìû</a>
            <a href="tel:+252770844167" title="Pharmacy" aria-label="Pharmacy Phone">üíä</a>
            <a href="tel:+252610923020" title="Doctor" aria-label="Doctor Phone">üë®‚Äç‚öïÔ∏è</a>
            <a href="https://www.facebook.com/share/15RSaXLD1f3/" title="Facebook" target="_blank" rel="noopener noreferrer" aria-label="Facebook">üìò</a>
            <a href="https://youtube.com/@bahnanohospital" title="YouTube" target="_blank" rel="noopener noreferrer" aria-label="YouTube">üì∫</a>
        </div>
        <p style="margin-top: 2rem; opacity: 0.6; font-size: 0.9rem;">
            üìç Zoobe-Opposite to Hayat Supermarket, Mogadishu<br>
            Baxnaano Hospital & Pharmacy. All Rights Reserved.
        </p>
    </footer>

    <!-- ===== üîë FIREBASE CONFIG SECTION - KU DARI HAGAAGKAAGA Halkan ===== -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

        // TODO: KU DARI HAGAAGKAAGA FIIREBASE KA Halkan
        // Ka heli: Firebase Console > Project Settings > General > Your apps
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY_HERE",           // <--- BADAL
            authDomain: "YOUR_PROJECT.firebaseapp.com", // <--- BADAL
            projectId: "YOUR_PROJECT_ID",         // <--- BADAL
            storageBucket: "YOUR_PROJECT.appspot.com", // <--- BADAL
            messagingSenderId: "YOUR_SENDER_ID", // <--- BADAL
            appId: "YOUR_APP_ID"                   // <--- BADAL
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        window.DataManager = {
            medicines: collection(db, 'medicines'),
            orders: collection(db, 'orders'),
            gallery: collection(db, 'gallery'),
            settings: collection(db, 'settings'),
            
            async getMedicines() {
                try {
                    const snapshot = await getDocs(this.medicines);
                    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                } catch (error) {
                    console.error("Error fetching medicines:", error);
                    throw new Error("Failed to load medicines. Check connection.");
                }
            },
            
            async saveOrder(order, prescriptionFile) {
                try {
                    let prescriptionUrl = null;
                    if (prescriptionFile) {
                        const storageRef = ref(storage, `prescriptions/${Date.now()}_${prescriptionFile.name}`);
                        await uploadBytes(storageRef, prescriptionFile);
                        prescriptionUrl = await getDownloadURL(storageRef);
                    }
                    
                    return await addDoc(this.orders, {
                        ...order,
                        prescription: prescriptionUrl,
                        timestamp: new Date().toISOString(),
                        status: 'PENDING'
                    });
                } catch (error) {
                    console.error("Error saving order:", error);
                    throw new Error("Failed to submit order. Try again.");
                }
            },
            
            async getGallery() {
                try {
                    const snapshot = await getDocs(this.gallery);
                    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                } catch (error) {
                    console.error("Error fetching gallery:", error);
                    throw new Error("Failed to load gallery.");
                }
            },
            
            async getSettings() {
                try {
                    const snapshot = await getDocs(this.settings);
                    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                } catch (error) {
                    console.error("Error fetching settings:", error);
                    return [];
                }
            }
        };

        onSnapshot(collection(db, 'medicines'), () => window.app?.loadMedicines());
        onSnapshot(collection(db, 'gallery'), () => window.app?.loadGallery());
        onSnapshot(collection(db, 'settings'), () => window.app?.loadSettings());
    </script>

    <script>
        class HospitalApp {
            constructor() {
                this.cart = this.loadCartFromStorage();
                this.logoUrl = null;
                this.initEventListeners();
            }

            initEventListeners() {
                const mobileMenuBtn = document.getElementById('mobileMenuToggle');
                mobileMenuBtn?.addEventListener('click', () => this.toggleMenu());
                const deliveryForm = document.getElementById('deliveryForm');
                deliveryForm?.addEventListener('submit', (e) => this.submitDelivery(e));
                const filterBtns = document.querySelectorAll('.filter-btn');
                filterBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => this.filterGallery(e, btn.dataset.filter));
                });
                const navLinks = document.querySelectorAll('.nav-links a');
                navLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        document.getElementById('navLinks').classList.remove('active');
                        document.getElementById('mobileMenuToggle').setAttribute('aria-expanded', 'false');
                    });
                });
                this.loadSettings();
            }

            toggleMenu() {
                const navLinks = document.getElementById('navLinks');
                const mobileMenuBtn = document.getElementById('mobileMenuToggle');
                navLinks.classList.toggle('active');
                const isExpanded = navLinks.classList.contains('active');
                mobileMenuBtn.setAttribute('aria-expanded', isExpanded);
            }

            async loadSettings() {
                try {
                    const settings = await DataManager.getSettings();
                    const logoSetting = settings.find(s => s.key === 'logo');
                    if (logoSetting?.value) {
                        this.logoUrl = logoSetting.value;
                        document.getElementById('logoDisplay').innerHTML = `<img src="${logoSetting.value}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;" alt="Logo">`;
                        document.getElementById('footerLogoDisplay').innerHTML = `<img src="${logoSetting.value}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;" alt="Logo">`;
                    }
                } catch (error) {
                    console.error("Failed to load logo:", error);
                }
            }

            async loadMedicines() {
                const grid = document.getElementById('medicineGrid');
                try {
                    const medicines = await DataManager.getMedicines();
                    if (medicines.length === 0) {
                        grid.innerHTML = '<p class="error">No medicines available at the moment.</p>';
                        return;
                    }
                    grid.innerHTML = medicines.map(med => `
                        <div class="medicine-card">
                            <div class="medicine-image">
                                ${med.image ? `<img src="${med.image}" alt="${this.escapeHtml(med.name)}" onerror="this.src='data:image/svg+xml,<svg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'250\\' height=\\'200\\'><rect width=\\'250\\' height=\\'200\\' fill=\\'%23ddd\\'/><text x=\\'50%\\' y=\\'50%\\' text-anchor=\\'middle\\' dy=\\'.3em\\' fill=\\'%23666\\'>üíä</text></svg>'">` : 'üíä'}
                            </div>
                            <div class="medicine-content">
                                <div class="medicine-name">${this.escapeHtml(med.name)}</div>
                                <div class="medicine-price">$${Number(med.price).toFixed(2)}</div>
                                <div class="medicine-description">${this.escapeHtml(med.description || '')}</div>
                                <div class="quantity-selector">
                                    <button class="quantity-btn" data-action="decrease" data-id="${med.id}">-</button>
                                    <input type="number" class="quantity-input" data-id="${med.id}" value="1" min="1" max="99">
                                    <button class="quantity-btn" data-action="increase" data-id="${med.id}">+</button>
                                </div>
                                <button class="add-to-cart-btn" data-medicine='${JSON.stringify(med).replace(/"/g, '&quot;')}'>
                                    Add to Cart
                                </button>
                            </div>
                        </div>
                    `).join('');
                    this.attachMedicineEventListeners();
                } catch (error) {
                    grid.innerHTML = `<p class="error">${error.message}</p>`;
                }
            }

            attachMedicineEventListeners() {
                document.querySelectorAll('.quantity-btn').forEach(btn => {
                    btn.addEventListener('click', () => this.updateQuantity(btn.dataset.id, btn.dataset.action));
                });
                document.querySelectorAll('.quantity-input').forEach(input => {
                    input.addEventListener('change', () => this.validateQuantity(input));
                });
                document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
                    btn.addEventListener('click', () => this.addToCart(JSON.parse(btn.dataset.medicine)));
                });
            }

            updateQuantity(id, action) {
                const input = document.querySelector(`.quantity-input[data-id="${id}"]`);
                const currentValue = parseInt(input.value) || 1;
                const newValue = action === 'increase' ? currentValue + 1 : Math.max(1, currentValue - 1);
                input.value = newValue;
            }

            validateQuantity(input) {
                input.value = Math.max(1, Math.min(99, parseInt(input.value) || 1));
            }

            addToCart(medicine) {
                const quantitySelector = document.querySelector(`.quantity-input[data-id="${medicine.id}"]`);
                const quantity = parseInt(quantitySelector?.value) || 1;
                const existingItem = this.cart.find(item => item.id === medicine.id);
                if (existingItem) {
                    existingItem.quantity += quantity;
                } else {
                    this.cart.push({ ...medicine, quantity, cartId: Date.now() });
                }
                this.saveCartToStorage();
                this.updateCartDisplay();
                this.showNotification(`‚úÖ ${this.escapeHtml(medicine.name)} added to cart!`, 'success');
            }

            removeFromCart(index) {
                this.cart.splice(index, 1);
                this.saveCartToStorage();
                this.updateCartDisplay();
            }

            updateCartDisplay() {
                const cartItems = document.getElementById('cartItems');
                const cartTotal = document.getElementById('cartTotal');
                const totalPrice = document.getElementById('totalPrice');
                if (this.cart.length === 0) {
                    cartItems.innerHTML = '<p style="text-align: center; color: #64748b;">Your cart is empty</p>';
                    cartTotal.style.display = 'none';
                    this.updateUSSDLink(0);
                    return;
                }
                cartItems.innerHTML = this.cart.map((item, index) => `
                    <div class="cart-item">
                        <div>
                            <strong>${this.escapeHtml(item.name)}</strong>
                            <div style="color: #64748b;">Quantity: ${item.quantity}</div>
                            <div style="color: var(--primary); font-weight: bold;">$${(item.price * item.quantity).toFixed(2)}</div>
                        </div>
                        <button class="btn" data-remove="${index}" style="background: var(--danger); padding: 0.5rem 1rem;">Remove</button>
                    </div>
                `).join('');
                document.querySelectorAll('[data-remove]').forEach(btn => {
                    btn.addEventListener('click', () => this.removeFromCart(parseInt(btn.dataset.remove)));
                });
                const total = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                totalPrice.textContent = `$${total.toFixed(2)}`;
                cartTotal.style.display = 'block';
                this.updateUSSDLink(total);
            }

            updateUSSDLink(amount) {
                const ussdLink = document.getElementById('ussdPaymentLink');
                const ussdAmount = document.getElementById('ussdAmount');
                const ussdInstructions = document.getElementById('ussdInstructions');
                if (amount > 0) {
                    const cleanAmount = Math.round(amount);
                    ussdAmount.textContent = cleanAmount;
                    ussdLink.href = `tel:*712*684006666*${cleanAmount}#`;
                    ussdLink.style.display = 'inline-block';
                    ussdInstructions.textContent = `Click to pay $${cleanAmount} via USSD`;
                } else {
                    ussdLink.style.display = 'none';
                    ussdInstructions.textContent = 'Submit order first, then click to complete payment';
                }
            }

            async submitDelivery(event) {
                event.preventDefault();
                const submitBtn = document.getElementById('submitOrderBtn');
                if (this.cart.length === 0) {
                    this.showNotification('‚ùå Your cart is empty! Add medicines first.', 'error');
                    return;
                }
                const delivery = {
                    customerName: document.getElementById('customerName').value.trim(),
                    customerPhone: document.getElementById('customerPhone').value.trim(),
                    deliveryAddress: document.getElementById('deliveryAddress').value.trim(),
                    instructions: document.getElementById('instructions').value.trim(),
                    medicines: [...this.cart],
                    totalAmount: this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                    status: 'PENDING'
                };
                const phonePattern = /^(00252|\+252|0)(61|62|65|66|67|68|69|71|72|73|74|77|78|79|90|91|92|93|94|95|96|97|98)\d{6}$/;
                if (!phonePattern.test(delivery.customerPhone)) {
                    this.showNotification('‚ùå Please enter a valid Somali phone number', 'error');
                    return;
                }
                submitBtn.disabled = true;
                submitBtn.textContent = '‚è≥ Submitting...';
                try {
                    const prescriptionFile = document.getElementById('prescriptionFile').files[0];
                    if (prescriptionFile && prescriptionFile.size > 5 * 1024 * 1024) {
                        throw new Error('Prescription file too large! Max 5MB');
                    }
                    await DataManager.saveOrder(delivery, prescriptionFile);
                    this.showNotification(
                        `‚úÖ Order submitted!\nüí≥ Total: $${delivery.totalAmount.toFixed(2)}\nüìû You will receive a call shortly`,
                        'success'
                    );
                    this.cart = [];
                    this.saveCartToStorage();
                    this.updateCartDisplay();
                    document.getElementById('deliveryForm').reset();
                    this.updateUSSDLink(delivery.totalAmount);
                } catch (error) {
                    this.showNotification(`‚ùå ${error.message}`, 'error');
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'üöö Request Delivery';
                }
            }

            async loadGallery() {
                const galleryGrid = document.getElementById('galleryGrid');
                try {
                    const gallery = await DataManager.getGallery();
                    if (gallery.length === 0) {
                        galleryGrid.innerHTML = '<p class="error">Gallery is empty.</p>';
                        return;
                    }
                    galleryGrid.innerHTML = gallery.map(item => `
                        <div class="gallery-item" data-type="${item.type}">
                            ${item.type === 'image' 
                                ? `<img src="${item.url}" alt="${this.escapeHtml(item.title)}" class="gallery-media" loading="lazy">` 
                                : `<video src="${item.url}" controls class="gallery-media"></video>`
                            }
                            <div class="gallery-overlay">
                                <h4>${this.escapeHtml(item.title)}</h4>
                                <p>${this.escapeHtml(item.description || '')}</p>
                                <p style="font-size: 0.8rem; color: #9ca3af; margin-top: 0.5rem;">${item.type.toUpperCase()} ‚Ä¢ ${item.date}</p>
                            </div>
                        </div>
                    `).join('');
                } catch (error) {
                    galleryGrid.innerHTML = `<p class="error">${error.message}</p>`;
                }
            }

            filterGallery(event, type) {
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                    btn.setAttribute('aria-pressed', 'false');
                });
                event.target.classList.add('active');
                event.target.setAttribute('aria-pressed', 'true');
                const items = document.querySelectorAll('.gallery-item');
                items.forEach(item => {
                    item.style.display = (type === 'all' || item.dataset.type === type) ? 'block' : 'none';
                });
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.setAttribute('role', 'alert');
                notification.setAttribute('aria-live', 'polite');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                document.body.appendChild(notification);
                setTimeout(() => {
                    notification.style.animation = 'fadeOut 0.5s ease';
                    setTimeout(() => notification.remove(), 500);
                }, 5000);
            }

            loadCartFromStorage() {
                try {
                    return JSON.parse(localStorage.getItem('baxnaano_cart') || '[]');
                } catch {
                    return [];
                }
            }

            saveCartToStorage() {
                localStorage.setItem('baxnaano_cart', JSON.stringify(this.cart));
            }

            async init() {
                await this.loadMedicines();
                this.updateCartDisplay();
                await this.loadGallery();
            }
        }

        window.app = new HospitalApp();
        window.addEventListener('DOMContentLoaded', () => window.app.init());
    </script>
</body>
</html>
